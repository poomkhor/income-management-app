<%- include('../partials/header') %>
<h1>Income Management Dashboard</h1>
<h2><%= user.name%></h2>
</br>
<div class='income'>
    <h2>Income Details</h2>
<table id='income'>
    <thead>
        <tr>
            <th>Date</th>
            <th>Source</th>
            <th>Amount</th>
            <th>Note</th>
        </tr>
    </thead>
    <tbody>
        <% let total = 0 %>
        <%income.forEach((i) => {%>
        <!-- get the total amount sum -->
        <% total += i.amount %>
        <tr>
            <!-- formate Date Object -->
            <% date= i.date.getDate().toString().padStart(2, '0') + '-' + (i.date.getMonth() + 1).toString().padStart(2, '0') + '-'+ i.date.getFullYear()%>
            <td><%= date %></td>
            <td><%=i.source%></td>
            <!-- convert the amount to currency THB -->
            <td><%=i.amount.toLocaleString("en-US",{style:"currency", currency:"THB"})%></td>
            <td><%=i.note%></td>
            <td><% if (user?._id.equals(i.user)) { %>
            <!-- delete action -->
              <form action="/income/<%= i._id %>?_method=DELETE" method="POST">
                <button type="submit">X</button>
              </form>
            <% } %>
          </td>
        </tr>
        <%});%>
        <tr>
        <!-- Total row in THB currency -->
        <td colspan="1"></td>
        <td><strong>Total Income</strong></td>
        <td><strong><%= total.toLocaleString("en-US",{style:"currency", currency:"THB"}) %></strong></td>
      </tr>
    </tbody>
</table>
</div>
<button><a href='/income/new'>ADD INCOME</a></button>

<%- include('../partials/footer') %>
